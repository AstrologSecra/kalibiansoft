#!/bin/bash

# Проверка наличия прав root
if [ "$EUID" -ne 0 ]; then
  echo "Пожалуйста, запустите скрипт с правами root (sudo)."
  exit 1
fi

# Запрос имени пользователя
read -p "Введите имя нового пользователя: " username

# Проверка, существует ли уже пользователь с таким именем
if id "$username" &>/dev/null; then
  echo "Пользователь $username уже существует."
  exit 1
fi

# Создание нового пользователя
useradd -m -s /bin/bash "$username"

# Установка пароля для пользователя
echo "Установите пароль для пользователя $username:"
passwd "$username"

# Добавление пользователя в группу wheel (если используется система, где wheel дает права sudo)
# Если не используется, можно пропустить этот шаг
usermod -aG wheel "$username"

# Настройка sudoers для разрешения использования команд root без пароля
echo "$username ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/99_$username

# Ограничение прав на файловую систему для пользователя
# Этот шаг требует осторожности, так как пользователь сможет выполнять команды от имени root
# но не сможет изменять файлы в домашнем каталоге root
setfacl -m u:$username:--- /root

echo "Пользователь $username создан и настроен для выполнения команд root без sudo."
echo "Ограничения на доступ к каталогу /root установлены."
